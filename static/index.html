<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Marya Pro Uploader</title>

<!-- Google Fonts + Icons -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:wght@400;600&display=swap" rel="stylesheet">

<style>
:root{--pri:#ef4444;--pri2:#f87171;--bg:#ffffff;--txt:#0f172a;--sub:#64748b}
@media(prefers-color-scheme:dark){:root{--bg:#0f0f23;--txt:#fff;--sub:#94a3b8}}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Inter,sans-serif;background:var(--bg);color:var(--txt);min-height:100vh;display:flex;justify-content:center}
.container{width:100%;max-width:820px;padding:32px}
header{text-align:center;margin-bottom:42px}
header img{width:90px;border-radius:20px;box-shadow:0 10px 28px rgba(239,68,68,.35)}
h1{font-size:2.5rem;font-weight:800;background:linear-gradient(135deg,#ef4444,#f87171);-webkit-background-clip:text;color:transparent;margin:14px 0}
p.sub{color:var(--sub)}
#drop{border:3px dashed rgba(239,68,68,.4);border-radius:18px;padding:60px 34px;text-align:center;cursor:pointer;background:rgba(239,68,68,.05);transition:.3s}
#drop.hover{background:rgba(239,68,68,.15)}
#drop .sym{font-family:"Material Symbols Rounded";font-size:80px;color:var(--pri);margin-bottom:12px}
#files{margin:28px 0}
.file{background:rgba(239,68,68,.08);border-left:5px solid var(--pri);border-radius:12px;padding:14px 18px;margin-top:10px;display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center}
.name{font-weight:600}
.bar{height:6px;background:#f1f5f9;border-radius:3px;overflow:hidden;margin-top:8px}
.fill{height:100%;width:0;background:linear-gradient(135deg,#ef4444,#f87171);transition:width .3s}
.remove{background:none;border:none;cursor:pointer;font-size:20px;color:var(--pri)}
.btn{display:flex;align-items:center;gap:6px;background:linear-gradient(135deg,#ef4444,#f87171);color:#fff;border:none;border-radius:12px;padding:14px 22px;font-weight:600;cursor:pointer;margin-right:12px}
.btn:disabled{opacity:.4;cursor:not-allowed}
.actions{display:flex;justify-content:flex-end;margin-top:26px}
.alert{color:var(--pri);margin-top:18px;text-align:center;display:none}
</style>
</head>
<body>
<div class="container">
  <header>
    <img src="https://marya-database.btfcompanystorage.workers.dev/view/ETTi4l5oIIIhmen181zo.png">
    <h1>Marya Pro Uploader</h1>
    <p class="sub">Permanent links • up to 2 GB per file</p>
  </header>

  <div id="drop">
    <div class="sym">upload</div>
    <div>Tap or drop files to upload</div>
    <small>PNG • MP4 • PDF … any format</small>
    <input id="pick" type="file" hidden multiple>
  </div>

  <div id="files"></div>

  <div class="actions">
    <button id="start" class="btn" disabled><span class="sym">cloud_upload</span>Start</button>
    <button id="cancel" class="btn" disabled><span class="sym">close</span>Cancel</button>
  </div>
  <div id="alert" class="alert"></div>
</div>

<script type="module">
const $ = s=>document.querySelector(s);
const drop=$('#drop'), pick=$('#pick'), list=$('#files'),
      start=$('#start'), cancel=$('#cancel'), alert=$('#alert');
let queue=[], xhr;

drop.onclick=()=>pick.click();
['dragover','drop'].forEach(e=>document.addEventListener(e,ev=>ev.preventDefault()));
drop.addEventListener('dragover',()=>drop.classList.add('hover'));
drop.addEventListener('dragleave',()=>drop.classList.remove('hover'));
drop.addEventListener('drop',e=>{drop.classList.remove('hover'); add([...e.dataTransfer.files]);});
pick.onchange=e=>add([...e.target.files]);

function add(arr){
  arr.forEach(f=>{ queue.push({f,el:create(f)}); });
  updateBtns();
}
function create(f){
  const div=document.createElement('div');div.className='file';
  div.innerHTML=`
    <div>
      <div class="name">${f.name}</div>
      <div class="bar"><div class="fill"></div></div>
    </div>
    <button class="remove">×</button>`;
  div.querySelector('.remove').onclick=()=>{
    queue=queue.filter(o=>o.f!==f); div.remove(); updateBtns();
  };
  list.appendChild(div); return div;
}
function updateBtns(){
  start.disabled=!queue.length; cancel.disabled=true;
}
start.onclick=upload; cancel.onclick=()=>{ if(xhr) xhr.abort(); };

function upload(){
  start.disabled=true; cancel.disabled=false; alert.style.display='none';
  (async()=>{
    for(const item of queue){
      const {f,el}=item;
      const fd=new FormData(); fd.append('file',f);
      try{
        xhr=new XMLHttpRequest(); xhr.open('POST','/upload');
        xhr.upload.onprogress=e=>{
          if(e.lengthComputable){
            el.querySelector('.fill').style.width=((e.loaded/e.total)*100)+'%';
          }
        };
        xhr.onload=()=>{
          if(xhr.status===200){
            const res=JSON.parse(xhr.responseText);
            el.innerHTML=`<a href="${res.view_url}" target="_blank">${res.filename}</a>`;
          }else err('Upload failed: '+xhr.statusText);
        };
        xhr.onerror=()=>err('Network error');
        xhr.send(fd);
        await waitLo(xhr);
      }catch(e){err(e.message);}
    }
    queue=[]; updateBtns();
  })();
}
function waitLo(x){return new Promise(r=>x.onloadend=r);}
function err(t){alert.textContent=t; alert.style.display='block';}
</script>
</body>
</html>
