<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marya Vault - Working</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; }
        h1 { color: #dc143c; text-align: center; }
        .upload-area {
            border: 3px dashed #dc143c;
            padding: 50px;
            text-align: center;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            margin: 20px 0;
        }
        .upload-area:hover { background: #fafafa; }
        .btn { 
            background: #dc143c; 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px;
        }
        .result { 
            background: white; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
            border-left: 4px solid #dc143c;
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Marya Vault</h1>
        
        <div class="upload-area" onclick="selectFile()">
            <h2>üìÅ Click Here to Upload Files</h2>
            <p>Maximum 2GB per file</p>
        </div>
        
        <input type="file" id="fileInput" class="hidden" multiple onchange="uploadFiles()">
        
        <div id="results"></div>
    </div>

    <script>
        console.log('Script loaded');
        
        function selectFile() {
            console.log('Upload area clicked');
            document.getElementById('fileInput').click();
        }
        
        function uploadFiles() {
            const files = document.getElementById('fileInput').files;
            console.log('Files selected:', files.length);
            
            if (files.length === 0) return;
            
            for (let file of files) {
                uploadSingleFile(file);
            }
        }
        
        function uploadSingleFile(file) {
            console.log('Uploading:', file.name);
            
            if (file.size > 2000000000) {
                alert('File too large (max 2GB)');
                return;
            }
            
            // Create result div
            const resultDiv = document.createElement('div');
            resultDiv.className = 'result';
            resultDiv.innerHTML = `
                <h3>${file.name}</h3>
                <p>Size: ${formatBytes(file.size)} ‚Ä¢ Status: <span id="status-${file.name}">Uploading...</span></p>
                <div id="actions-${file.name}"></div>
            `;
            document.getElementById('results').appendChild(resultDiv);
            
            // Upload using XMLHttpRequest
            const xhr = new XMLHttpRequest();
            const formData = new FormData();
            formData.append('file', file);
            
            xhr.onload = function() {
                console.log('Upload response:', xhr.status, xhr.responseText);
                
                if (xhr.status === 200) {
                    try {
                        const result = JSON.parse(xhr.responseText);
                        if (result.success) {
                            document.getElementById(`status-${file.name}`).textContent = 'Complete ‚úÖ';
                            document.getElementById(`actions-${file.name}`).innerHTML = `
                                <button class="btn" onclick="window.open('${result.url}')">üëÅÔ∏è View</button>
                                <button class="btn" onclick="window.open('${result.download}')">‚¨áÔ∏è Download</button>
                                <button class="btn" onclick="copyText('${result.url}')">üìã Copy</button>
                            `;
                        } else {
                            document.getElementById(`status-${file.name}`).textContent = 'Failed: ' + result.error;
                        }
                    } catch (e) {
                        document.getElementById(`status-${file.name}`).textContent = 'Failed: Invalid response';
                    }
                } else {
                    document.getElementById(`status-${file.name}`).textContent = `Failed: HTTP ${xhr.status}`;
                }
            };
            
            xhr.onerror = function() {
                document.getElementById(`status-${file.name}`).textContent = 'Failed: Network error';
            };
            
            xhr.open('POST', '/upload');
            xhr.send(formData);
        }
        
        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i)) + ' ' + sizes[i];
        }
        
        function copyText(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Link copied!');
            });
        }
        
        console.log('All functions loaded');
    </script>
</body>
</html>
